{"ast":null,"code":"import { BaseChain } from \"./base.js\";\nimport { loadQAStuffChain } from \"./question_answering/load.js\";\nexport class VectorDBQAChain extends BaseChain {\n  get inputKeys() {\n    return [this.inputKey];\n  }\n  constructor(fields) {\n    super();\n    Object.defineProperty(this, \"k\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: 4\n    });\n    Object.defineProperty(this, \"inputKey\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: \"query\"\n    });\n    Object.defineProperty(this, \"outputKey\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: \"result\"\n    });\n    Object.defineProperty(this, \"vectorstore\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"combineDocumentsChain\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: void 0\n    });\n    Object.defineProperty(this, \"returnSourceDocuments\", {\n      enumerable: true,\n      configurable: true,\n      writable: true,\n      value: false\n    });\n    this.vectorstore = fields.vectorstore;\n    this.combineDocumentsChain = fields.combineDocumentsChain;\n    this.inputKey = fields.inputKey ?? this.inputKey;\n    this.outputKey = fields.outputKey ?? this.outputKey;\n    this.k = fields.k ?? this.k;\n    this.returnSourceDocuments = fields.returnSourceDocuments ?? this.returnSourceDocuments;\n  }\n  async _call(values) {\n    if (!(this.inputKey in values)) {\n      throw new Error(`Question key ${this.inputKey} not found.`);\n    }\n    const question = values[this.inputKey];\n    const docs = await this.vectorstore.similaritySearch(question, this.k);\n    const inputs = {\n      question,\n      input_documents: docs\n    };\n    const result = await this.combineDocumentsChain.call(inputs);\n    if (this.returnSourceDocuments) {\n      return {\n        ...result,\n        sourceDocuments: docs\n      };\n    }\n    return result;\n  }\n  _chainType() {\n    return \"vector_db_qa\";\n  }\n  static async deserialize(data, values) {\n    if (!(\"vectorstore\" in values)) {\n      throw new Error(`Need to pass in a vectorstore to deserialize VectorDBQAChain`);\n    }\n    const {\n      vectorstore\n    } = values;\n    if (!data.combine_documents_chain) {\n      throw new Error(`VectorDBQAChain must have combine_documents_chain in serialized data`);\n    }\n    return new VectorDBQAChain({\n      combineDocumentsChain: await BaseChain.deserialize(data.combine_documents_chain),\n      k: data.k,\n      vectorstore\n    });\n  }\n  serialize() {\n    return {\n      _type: this._chainType(),\n      combine_documents_chain: this.combineDocumentsChain.serialize(),\n      k: this.k\n    };\n  }\n  static fromLLM(llm, vectorstore, options) {\n    const qaChain = loadQAStuffChain(llm);\n    return new this({\n      vectorstore,\n      combineDocumentsChain: qaChain,\n      ...options\n    });\n  }\n}","map":{"version":3,"names":["BaseChain","loadQAStuffChain","VectorDBQAChain","inputKeys","inputKey","constructor","fields","Object","defineProperty","enumerable","configurable","writable","value","vectorstore","combineDocumentsChain","outputKey","k","returnSourceDocuments","_call","values","Error","question","docs","similaritySearch","inputs","input_documents","result","call","sourceDocuments","_chainType","deserialize","data","combine_documents_chain","serialize","_type","fromLLM","llm","options","qaChain"],"sources":["/Users/b/Code/langchainjs/langchain/dist/chains/vector_db_qa.js"],"sourcesContent":["import { BaseChain } from \"./base.js\";\nimport { loadQAStuffChain } from \"./question_answering/load.js\";\nexport class VectorDBQAChain extends BaseChain {\n    get inputKeys() {\n        return [this.inputKey];\n    }\n    constructor(fields) {\n        super();\n        Object.defineProperty(this, \"k\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: 4\n        });\n        Object.defineProperty(this, \"inputKey\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"query\"\n        });\n        Object.defineProperty(this, \"outputKey\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: \"result\"\n        });\n        Object.defineProperty(this, \"vectorstore\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"combineDocumentsChain\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: void 0\n        });\n        Object.defineProperty(this, \"returnSourceDocuments\", {\n            enumerable: true,\n            configurable: true,\n            writable: true,\n            value: false\n        });\n        this.vectorstore = fields.vectorstore;\n        this.combineDocumentsChain = fields.combineDocumentsChain;\n        this.inputKey = fields.inputKey ?? this.inputKey;\n        this.outputKey = fields.outputKey ?? this.outputKey;\n        this.k = fields.k ?? this.k;\n        this.returnSourceDocuments =\n            fields.returnSourceDocuments ?? this.returnSourceDocuments;\n    }\n    async _call(values) {\n        if (!(this.inputKey in values)) {\n            throw new Error(`Question key ${this.inputKey} not found.`);\n        }\n        const question = values[this.inputKey];\n        const docs = await this.vectorstore.similaritySearch(question, this.k);\n        const inputs = { question, input_documents: docs };\n        const result = await this.combineDocumentsChain.call(inputs);\n        if (this.returnSourceDocuments) {\n            return {\n                ...result,\n                sourceDocuments: docs,\n            };\n        }\n        return result;\n    }\n    _chainType() {\n        return \"vector_db_qa\";\n    }\n    static async deserialize(data, values) {\n        if (!(\"vectorstore\" in values)) {\n            throw new Error(`Need to pass in a vectorstore to deserialize VectorDBQAChain`);\n        }\n        const { vectorstore } = values;\n        if (!data.combine_documents_chain) {\n            throw new Error(`VectorDBQAChain must have combine_documents_chain in serialized data`);\n        }\n        return new VectorDBQAChain({\n            combineDocumentsChain: await BaseChain.deserialize(data.combine_documents_chain),\n            k: data.k,\n            vectorstore,\n        });\n    }\n    serialize() {\n        return {\n            _type: this._chainType(),\n            combine_documents_chain: this.combineDocumentsChain.serialize(),\n            k: this.k,\n        };\n    }\n    static fromLLM(llm, vectorstore, options) {\n        const qaChain = loadQAStuffChain(llm);\n        return new this({\n            vectorstore,\n            combineDocumentsChain: qaChain,\n            ...options,\n        });\n    }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}